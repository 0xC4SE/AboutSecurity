# 出报告专用

---

最后修改时间 2020-6-23

---

## 修复建议

**认证**

- 对于存在弱口令的系统，需在加强使用者安全意识的前提下，督促其修改密码，或者使用策略来强制限制密码长度和复杂性。
- 对于存在弱口令或是空口令的服务，在一些关键服务上，应加强口令强度，同时需使用加密传输方式，对于一些可关闭的服务来说，建议关闭该服务以达到安全目的。
- 对于出现验证码功能的系统或服务，不能只在前端进行防护，而是要在后台进行二次检测，做到前后端同时加固。

**应用**

- 对于 Oracle 相关应用,建议及时更新到最新版本,安装最新补丁,详情可见官方安全公告 https://www.oracle.com/security-alerts/
- 对于 Struts2 应用,管理员需及时关注官方的安全公告 https://cwiki.apache.org/confluence/display/WW/Security+Bulletins
- 对于 Harbor 应用,管理员需及时关注官方的安全公告 https://github.com/goharbor/harbor/security/advisories
- 对于 jira 应用,管理员需及时关注官方的安全公告 https://jira.atlassian.com/browse/JRASERVER-69858?filter=13085
- 对于 Weblogic 相关应用,建议及时更新到最新版本,安装最新补丁,详情可见官方安全公告 https://www.oracle.com/security-alerts/
- 对于 shiro 应用,管理员需及时关注官方的安全公告 https://issues.apache.org/jira/projects/SHIRO/issues
- 对于 Solr 应用,管理员需及时关注官方的安全公告 https://issues.apache.org/jira/projects/SOLR/issues
- 对于 jenkins 应用,管理员需及时关注官方的安全公告 https://jenkins.io/security/advisories/
- 对于用户登录后涉及用户唯一信息的请求，每次都要验证检查所有权，敏感信息页面加随机数的参数，防止浏览器缓存内容。

**主机**

- 对于 Windows 主机的漏洞防护,管理员需及时关注微软官方的安全公告 https://portal.msrc.microsoft.com/zh-cn/security-guidance
- 对于 UNIX 主机的漏洞防护,管理员需关注相应发行版本官方安全公告

---

# 认证
## 弱口令/空口令

**web 后台系统弱口令**

`漏洞评级建议: 高危`

- 详情
    > 渗透测试过程中，发现目标 web 后台管理存在弱口令组合。

- 造成的危害
    > 攻击者利用此漏洞可直接进入应用系统或者管理系统，从而进行系统、网页、数据的篡改与删除，非法获取系统、用户的数据，甚至可能导致服务器沦陷。

- 修复建议
    - 用户层面
        1. 不要使用常见的弱口令作为密码
        2. 不要多个系统或者社交账号使用同一套密码
        3. 定期修改密码
        4. 建议使用包含随机值的或者随机生成的字符串作为系统密码
    - 系统层面
        1. 用户首次登录后强制用户修改默认密码
        2. 修改密码、添加账号等涉及密码策略处强制用户使用强密码策略（大小写字母+数字+特殊字符+8位以上）
        3. 服务端对登录处增加图形验证码并保证使用一次即销毁
        4. 服务端对登录接口进行限制，单个IP单位时间内请求超过阈值，封禁30分钟
        5. 服务端对登录接口进行限制，单个用户密码单位时间内错误次数超过阈值，封禁20分钟

**ftp 弱口令**

`漏洞评级建议: 高危,若无实际利用点建议降为中危`

- 详情
    > 渗透测试过程中，发现远程 FTP Server 允许以弱口令组合登录。

- 造成的危害
    > 这可能允许攻击者上传恶意文件或者下载敏感文件。

- 修复建议
    > FTP 服务如果不是必须使用，可以关闭，或更新到最新版本，并不要采用弱口令。

**ftp 匿名登陆**

`漏洞评级建议: 高危,若无实际利用点建议降为中危`

- 详情
    > 渗透测试过程中，发现目标主机开放的 ftp 服务允许匿名用户进行登录。

- 造成的危害
    > 黑客利用弱口令或匿名登录漏洞直接登录 FTP 服务，上传恶意文件，从而获取系统权限，并可能造成数据泄露。

- 修复建议
    > FTP 服务如果不是必须使用，可以关闭，或更新到最新版本，并关闭匿名访问。

**SSH 弱口令**

`漏洞评级建议: 高危`

- 详情
    > SSH 弱口令漏洞指 Linux 系统口令的长度太短或者复杂度不够，如仅包含数字，或仅包含字母等，弱口令容易被破解。攻击者可以利用弱口令直接登录SSH服务器，读取甚至修改网站代码，或者导致服务器沦陷。

- 造成的危害
    > 攻击者经过爆破登陆后可完全控制机器，即使低权限账号也可以通过提权进行进一步的破坏。

- 修复建议
    1. 修改口令，增加口令复杂度，如包含大小写字母、数字和特殊字符等。
    2. 修改默认口令，避免默认口令被猜解。
    3. 指定健壮的口令策略，比如指定每隔30天修改一次密码，密码不得与历史密码相同。

**数据库弱口令**

`漏洞评级建议: 高危`

- 详情
    > 数据库弱口令漏洞指数据库管理员账号对应密码的长度太短或者复杂度不够，仅包含数字，或仅包含字母等，弱口令容易被破解，一旦被攻击者获取，可用来直接登录数据库系统，读取甚至修改服务器上的文件，或者导致服务器沦陷。

- 造成的危害
    > 攻击者可直接操作数据库,甚至可以进行提权拿到服务器权限。

- 修复建议
    1. 修改口令，增加口令复杂度，如包含大小写字母、数字和特殊字符等。
    2. 修改默认口令，避免默认口令被猜解。
    3. 指定健壮的口令策略，比如指定每隔30天修改一次密码，密码不得与历史密码相同。

**xxx 弱口令/空口令**

`漏洞评级建议: 高危,若无实际利用点建议降为中危`

- 详情
    > 渗透测试过程中，发现目标服务器存在 xxx 服务弱口令问题。

- 造成的危害
    > 攻击者经过爆破登陆后可完全控制机器，即使低权限账号也可以通过提权进行进一步的破坏。

    或

    > 攻击者经过爆破登陆后可完全控制目标数据库，进而可以对数据信息进行窃取、篡改等操作。

- 修复建议
    1. 账号不要采用弱口令，建议密码强度 8 位以上，大小写数字混合。
    2. 只允许可信 IP 进行连接。

**xxx 后台无安全认证**

`漏洞评级建议: 高危,若无实际利用点建议降为中危`

- 详情
    > 渗透测试过程中，发现目标xxx服务无任何安全认证。

- 造成的危害
    > 攻击者利用此漏洞可直接进入应用系统或者管理系统，从而进行系统、网页、数据的篡改与删除，非法获取系统、用户的数据，甚至可能导致服务器沦陷。

- 修复建议
    - 用户层面
        1. 不要使用常见的弱口令作为密码
        2. 不要多个系统或者社交账号使用同一套密码
        3. 定期修改密码
        4. 建议使用包含随机值的或者随机生成的字符串作为系统密码
    - 系统层面
        1. 用户首次登录后强制用户修改默认密码
        2. 修改密码、添加账号等涉及密码策略处强制用户使用强密码策略（大小写字母+数字+特殊字符+8位以上）
        3. 服务端对登录处增加图形验证码并保证使用一次即销毁
        4. 服务端对登录接口进行限制，单个IP单位时间内请求超过阈值，封禁30分钟
        5. 服务端对登录接口进行限制，单个用户密码单位时间内错误次数超过阈值，封禁20分钟

---

# 主机
## windows

**MS12-020**

`漏洞评级建议: 高危`

- 详情
    > MS12-020 漏洞是微软在 12 年发布的一个 windows 系统漏洞，该漏洞针对于windows xp 和 windows sever 2003 等系统。攻击者通过该漏洞对目标主机进行攻击，可导致目标主机蓝屏。

- 造成的危害
    > 远程攻击者在未经认证的情况下往服务器发送畸形恶意的数据包，便可以以系统权限或者 NET SERVICE 权限执行任意命令。

- 修复建议
    > 针对 MS12-020 漏洞，微软官方已放出相应的补丁，建议及时安装官方补丁:http://technet.microsoft.com/en-us/security/bulletin/ms12-020

**MS14-066**

`漏洞评级建议: 高危`

- 详情
    > 目标主机存在 MS14-066 漏洞，由于安全通道（Schannel）安全包对包的处理不当，远程Windows主机受到远程代码执行漏洞的影响。

- 造成的危害
    > 攻击者可以通过将特制数据包发送到Windows服务器来利用此漏洞。

- 修复建议
    > 针对 MS14-066 漏洞，微软官方已放出相应的补丁，建议及时安装官方补丁:https://docs.microsoft.com/en-us/security-updates/securitybulletins/2014/ms14-066

**MS15-034**

`漏洞评级建议: 高危`

- 详情
    > 目标主机存在 MS15-034 漏洞，如果攻击者向受影响的 Windows 系统发送经特殊设计的的 HTTP 请求，此漏洞可能允许远程执行代码。

- 造成的危害
    > 利用 HTTP.sys 的安全漏洞，攻击者只需要发送恶意的 http 请求数据包，就可能远程读取 IIS 服务器的内存数据，或使服务器系统蓝屏崩溃。

- 修复建议
    > 针对 MS15-034 漏洞，微软官方已放出相应的补丁，建议及时安装官方补丁：https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2015/ms15-034

**MS17-010**

`漏洞评级建议: 高危`

- 详情
    > 目标主机存在 MS17-010 漏洞。如果攻击者向 Windows SMBv1 服务器发送特殊设计的消息，那么其中最严重的漏洞可能允许远程执行代码。

- 造成的危害
    > 该漏洞是 Windows 的 SMB 服务处理 SMB v1 请求时发生的漏洞，这个漏洞导致攻击者可以使用该漏洞使目标机器反代连接到 cc 服务器，进行远程控制主机、在局域网传播木马等破坏行为。

- 修复建议
    > 针对 MS17-010 漏洞，微软官方已放出相应的补丁，建议及时安装官方补丁:https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/ms17-010

**CVE-2019-0708 漏洞**

`漏洞评级建议: 高危`

- 详情
    > 目标主机存在 Windows 高危远程漏洞 CVE-2019-0708。当未经身份验证的攻击者使用 RDP 连接到目标系统并发送经特殊设计的请求时，远程桌面服务（以前称为“终端服务”）中存在远程执行代码漏洞。此漏洞是预身份验证，无需用户交互。

- 造成的危害
    > 攻击者一旦成功利用该漏洞，便可以在目标系统上执行任意代码，包括获取敏感信息、执行远程代码、发起拒绝服务攻击等等攻击行为。

- 修复建议
    ```
    针对 CVE-2019-0708 漏洞，Microsoft 已经为此发布了一个安全公告以及相应补丁:
    https://portal.msrc.microsoft.com/zh-CN/security-guidance/advisory/CVE-2019-0708
    https://support.microsoft.com/en-us/help/4500331/windows-update-kb4500331
    ```

---

# 应用
## web
### 常见

**代码执行漏洞**

`漏洞评级建议: 高危`

- 详情
    > 命令执行/注入漏洞通常因为应用在服务器上拼接系统命令而造成的漏洞。攻击者通过提交恶意构造的参数破坏命令语句结构，从而达到执行恶意命令的目的。

- 造成的危害
    > 攻击者可在服务器通过利用拼接、管道符、通配符等绕过手段来执行任意命令，写入后门，从而入侵服务器，获取服务器权限，直接导致服务器沦陷。

- 修复建议
    1. 在代码级调用shell时，对命令行中的特殊字符（比如|、&、；等）进行转义，防止执行其他非法命令。
    2. 根据业务逻辑进行白名单方式校验或使用正则表达式进行过滤。
    3. PHP中可使用escapeshellarg、escapeshellcmd来转义对应敏感字符。
    4. 对于相关敏感的命令执行函数，做好参数校验和合法性验证，或者直接在配置文件中禁用该函数，不要让用户可以直接控制eval、system、exec、shell_exec等函数的参数 。

**文件上传漏洞**

`漏洞评级建议: 高危`

- 详情
    > 测试过程中发现目标站点存在文件上传漏洞,应用系统在文件上传功能处对用户上传文件类型、格式、内容等做合法性校验，导致攻击者可以上传Webshell（.php、.jsp、asp等）恶意脚本文件或者非期望格式的文件比如：HTML文件、SHTML文件等，同时可利用目录跳转等字符或者控制上传目录，直接上传文件到Web目录或任意目录下，从而可能导致在远程服务器上执行任意恶意脚本文件，从而直接获取应用系统权限。

- 造成的危害
    1. 上传恶意脚本文件到服务器中，通过访问该恶意文件从而执行文件中的恶意代码；
    2. 攻击者可利用目录跳转上传 php、config 等文件，覆盖原有的系统文件，到达篡改系统文件、甚至获取系统权限的目的；
    3. 攻击者可上传 html、shtm 等文件，并写入非法博彩、赌博等恶意 SEO 页面或者写入恶意 js 文件进行钓鱼来非法获取用户信息等；

- 修复建议
    1. 限制文件上传类型。
    2. 限制上传文件大小。
    3. 确保上传文件被访问正确返回。
    4. 确保上传的文件放在安全的路径下，必要时可以将上传的文件存在 web server 之外的远程服务器。
    5. 设置项目目录权限:可写目录不执行，执行目录不可写。

    - 代码层面
        - 服务端采用白名单方式校验文件后缀，不建议采用黑名单方式校验后缀，黑名单方式校验可能导致攻击者利用文件特性、系统特性、黑名单不全等方式进行绕过攻击；
        - 服务端对上传文件进行重命名，防止利用目录跳转等方式控制上传目录；
        - 服务端使用系统函数来判断文件类型及文件内容是否合法，比如 PHP 中的 getimagesize；
        - 对上传的文件回显相对路径或者不显示路径；
    - 其他层面
        - 建议使用 OSS 静态存储服务器来存储用户上传的文件；
        - 设置目录权限限制，禁止上传目录的执行权限；
        - 保证使用的 Nginx、Apache、IIS 等容器版本不存在解析漏洞；
        - 保证使用的第三方处理软件的版本比如 FFmpeg、ImageMagick 等不存在已知漏洞

**任意文件读取/下载**

`漏洞评级建议: 高危`

- 详情
    > 在读取文件内容文件或文件下载处，未严格限制读取/下载文件的路径及文件后缀，导致可利用../，#等目录操作字符进行目录穿越、截断等手段，从而读取/下载服务器上任意文件，比如配置文件等。

- 造成的危害
    > 如果系统未对读取/下载文件的文件目录做限制，攻击者利用此漏洞可直接读取web目录下任意文件，比如配置文件、数据库文件等，甚至直接获取服务器上任意文件内容。

- 修复建议
    1. 配置文件：在配置文件中限制访问的文件目录，比如PHP中php.ini配置open_basedir
    2. 特殊字符过滤：检查用户输入，过滤或转义含有“../”、“..\”、“%00”，“..”，“./”，“#”等跳转目录或字符终止符、截断字符的输入
    3. 合法性判断：严格过滤用户输入字符的合法性，比如文件类型、文件地址、文件内容等
    4. 白名单：白名单限定访问文件的路径、名称及后缀名

**任意文件包含**

`漏洞评级建议: 高危`

- 详情
    > 在通过PHP的incluede、require等函数引入文件时，由于传入的文件名没有经过合理的校验，从而操作了预想之外的文件，导致意外的文件泄露甚至恶意的代码注入，主要包括本地文件包含和远程文件包含两种形式。

- 造成的危害
    > 攻击者利用此漏洞通过包含含有任意恶意代码的任意格式文件，比如图片文件、log文件等，可直接获取应用系统权限，如果开启了allow_url_fopen/allow_url_include等配置，可直接包含远程任意格式文件。

- 修复建议
    1. 配置文件：在配置文件中限制访问的文件目录，比如PHP中php.ini配置open_basedir
    2. 特殊字符过滤：检查用户输入，过滤或转义含有“../”、“..\”、“%00”，“..”，“./”，“#”等跳转目录或字符终止符、截断字符的输入
    3. 合法性判断：严格过滤用户输入字符的合法性，比如文件类型、文件地址、文件内容等
    4. 白名单：白名单限定访问文件的路径、名称及后缀名

**任意文件删除**

`漏洞评级建议: 高危`

- 详情
    > 渗透测试过程中，发现应用程序在删除文件前，未对所要删除的文件内容、类型、文件名、文件目录做合法性校验，导致可删除服务器上任意文件，比如删除安装目录中锁文件，直接进行重装应用系统。

- 造成的危害
    > 攻击者利用此漏洞可直接删除web目录甚至服务器上任意格式文件，直接导致业务系统中断、崩溃。

- 修复建议
    1. 配置文件：在配置文件中限制访问的文件目录，比如PHP中php.ini配置open_basedir
    2. 特殊字符过滤：检查用户输入，过滤或转义含有“../”、“..\”、“%00”，“..”，“./”，“#”等跳转目录或字符终止符、截断字符的输入
    3. 合法性判断：严格过滤用户输入字符的合法性，比如文件类型、文件地址、文件内容等
    4. 白名单：白名单限定访问文件的路径、名称及后缀名

**目录浏览漏洞**

`漏洞评级建议: 低危,造成影响非常严重建议中危或者高危`

- 详情
    > 目录浏览漏洞主要是由于配置不当，当访问到某一目录中没有索引文件时（或者手工开启了目录浏览功能）即把当前目录中的所有文件及相关下层目录一一在页面中显示出来。通过该漏洞攻击者可获得服务器上的文件目录结构，从而下载敏感文件（备份文件存放地址、数据文件、数据库文件、源代码文件等）。

- 造成的危害
    > 攻击者通过该漏洞可以看到服务器上的文件目录结构，获取应用系统文件敏感文件，比如备份文件、数据库文件、源代码文件等，导致应用程序大量敏感信息泄漏。

- 修复建议
    ```
    1. 通过修改配置文件，去除中间件（如IIS、apache、nginx）的文件目录索引功能。
        - IIS：只需要进入IIS管理器，选择对应的网站，然后在功能视图中的IIS项双击【目录浏览】，然后在操作的地方点击【禁用】即可。另外也可以在网站目录下找到web.config文件，将<directoryBrowse enabled="true" />中的true修改为false。
        - Apache：在配置文件中将Options Indexes FollowSymLinks在Indexes前面加上-符号。即： Options -Indexes FollowSymLinks。
        - Nginx：在配置文件中将autoindex on;去掉或者直接注释掉即可。
    2. 设置文件目录的访问权限。
    3. 在每个目录下创建一个空的 index.html 页面。
    ```

**CSRF**

`漏洞评级建议: 中危`

- 详情
    > CSRF（Cross-site request forgery）跨站请求伪造，也被称为“One Click Attack”或者Session Riding，通常缩写为CSRF，是一种对网站的恶意利用。尽管听起来像跨站脚本（XSS），但它与XSS非常不同，XSS利用站点内的信任用户，而CSRF则通过伪装来自受信任用户的请求来利用受信任的网站。攻击者通过伪造来自受信任用户的请求，达到增加、删除、篡改网站内容的目的。

- 造成的危害
    > CSRF 攻击可以在受害者毫不知情的情况下以受害者名义伪造请求发送给受攻击站点，从而在并未授权的情况下执行在权限保护之下的操作。最常见的攻击场景为：攻击者冒充用户/管理员伪造请求，进行网页篡改；用户修改、添加用户、密码修改；发送帖子、消息等非法操作。

- 修复建议
    ```
    1. 验证 HTTP Referer 字段
    2. 在请求地址中增加csrftoken验证，csrftoken可以在用户登陆后产生并放于 session 之中，然后在每次请求时把csrftoken从 session 中拿出，与请求中的csrftoken进行比对。对于GET请求，csrftoken将附在请求地址之后，对于POST请求来说，要在form的最后加上 <input type="hidden" name="csrftoken" value="tokenvalue"/>；
    3. 在 HTTP 头中自定义属性并验证
    4. 对于web站点，将持久化的授权方法（例如 cookie 或者 HTTP 授权）切换为瞬时的授权方法（在每个 form 中提供隐藏field），可以帮助网站防止 CSRF 攻击。
    5. 过滤用户输入，不允许发布含有站内操作URL的链接；
    6. 在浏览其它站点前登出站点或者在浏览器会话结束后清理浏览器的cookie。
    ```

**SSRF**

`漏洞评级建议: 中危`

- 详情
    > 很多 web 应用都提供了从其他的服务器上获取数据的功能。使用用户指定的 URL，web 应用可以获取图片，下载文件，读取文件内容等。这个功能如果被恶意使用，可以利用存在缺陷的 web 应用作为代理攻击远程和本地的服务器。这种形式的攻击称为服务端请求伪造攻击(Server-side Request Forgery)。即：利用一个可以发起网络请求的服务，当作跳板来攻击其他服务。

- 造成的危害
    1. 内网、本地端口扫描，获取开放端口信息；
    2. 主机信息收集，web应用指纹识别，获取服务banner信息等；
    3. 根据识别出的应用针对性的发送payload攻击，例如struts2、redis、攻击内网、本地的应用程序及服务等；
    4. 穿越防火墙；
    5. 利用file等其他允许协议进行绕过攻击，比如利用file协议读取本地文件（file:///etc/passwd）


- 修复建议
    ```
    1. 限制返回信息格式。
    2. 避免回显，删除或统一错误信息。
    3. 黑名单内网 ip 地址。
    4. 只允许使用 http 和 https 协议。
    ```

    - 解析目标URL
        - 获取scheme、host（推荐使用系统内置函数完成,避免自己使用正则提取）
    - 校验scheme
        - 检查 scheme 是否为合法 (如非特殊需求请只允许 http 和 https)
    - 获取解析IP
        - 解析 host 获取 dns 解析后的 IP 地址
    - 检测IP是否合法
        - 检查解析后的IP地址是否为外网地址或者合法IP

**XSS**

`漏洞评级建议: 高危`

- 详情

    XSS 又称 CSS，全称 Cross SiteScript，跨站脚本攻击，是 Web 程序中常见的漏洞，XSS 属于被动式且用于客户端的攻击方式，所以容易被忽略其危害性。其原理是攻击者向有 XSS 漏洞的网站中输入(传入)恶意的 HTML 代码，当其它用户浏览该网站时，这段 HTML 代码会自动执行，从而达到攻击的目的。如，盗取用户 Cookie、破坏页面结构、重定向到其它网站等。

    根据是否写入数据看来分类主要有反射性和存储型两大类。
    - 反射型跨站脚本（Reflected XSS）
        - 反射性XSS通常需要被攻击者点击对应的链接才能触发，且受到XSS Auditor、NoScript等防御手段的影响较大。
    - 储存型跨站脚本（Persistent XSS）
        - 存储型XSS由于存储在数据库或其他持久性中间件中，所以用户只需浏览了包含恶意代码的页面即可在用户无感知的情况下触发。

    区别：存储型XSS的恶意代码存在数据库里，反射型XSS的恶意代码存在URL里。

- 造成的危害

    1. 钓鱼欺骗：最典型的就是利用目标网站的反射型跨站脚本漏洞将目标网站重定向到钓鱼网站，或者注入钓鱼JavaScript以监控目标网站的表单输入，甚至发起基于DHTML更高级的钓鱼攻击方式。
    2. 网站挂马：跨站后利用IFrame嵌入隐藏的恶意网站或者将被攻击者定向到恶意网站上，或者弹出恶意网站窗口等方式都可以进行挂马攻击。
    3. 身份盗用：Cookie是用户对于特定网站的身份验证标志，XSS可以盗取用户的Cookie，就可以获取到用户对网站的操作权限，从而查看用户隐私信息。
    4. 用户劫持：一些高级的XSS，比如xss蠕虫等。
    5. 控制受害者机器向其他系统发起攻击。

- 修复建议
    ```
    1. 不信任用户提交的任何内容，对所有用户提交内容进行可靠的输入验证，包括对 URL、查询关键字、HTTP 头、REFER、POST 数据等，仅接受指定长度范围内、采用适当格式、采用所预期的字符的内容提交，对其他的一律过滤。尽量采用 POST 而非 GET 提交表单;对"<"，">"，";"，"""等字符做过滤;任何内容输出到页面之前都必须加以 en-code，避免不小心把 htmltag 显示出来。
    2. 实现 Session 标记(session tokens)、CAPTCHA(验证码)系统或者 HTTP 引用头检查，以防功能被第三方网站所执行，对于用户提交信息的中的 img 等 link，检查是否有重定向回本站、不是真的图片等可疑操作。
    3. cookie 防盗。避免直接在 cookie 中泄露用户隐私，例如 email、密码，等等;通过使 cookie 和系统 IP 绑定来降低 cookie 泄露后的危险。这样攻击者得到的 cookie 没有实际价值，很难拿来直接进行重放攻击。
    4. 确认接收的内容被妥善地规范化，仅包含最小的、安全的 Tag(没有 JavaScript)，去掉任何对远程内容的引用(尤其是样式表和 JavaScript)，使用 HTTPonly 的 cookie。
    ```

    - 代码层面
        - 在服务端进行输入验证（输入验证）
            - 服务器后端进行输入验证，包括输入的数据类型、数据长度、数据格式、特殊字符等进行验证。
        - 数据输出实体编码（输出编码）
            - 输出编码手段主要有3种编码：URL编码、HTML编码和JavaScript编码。
            - JAVA：开源的ESAPI library；框架（Spring：HtmlUtils.htmlEscape） PHP：使用htmlspecialchars等函数进行过滤输出
    - 其他层面
        - 使用模版引擎
            - 开启模板引擎自带的 HTML 转义功能。例如： 在 ejs 中，尽量使用 <%= data %> 而不是 <%- data %>； 在 doT.js 中，尽量使用{{! data } 而不是 {{= data }； 在 FreeMarker 中，确保引擎版本高于 2.3.24，并且选择正确的 freemarker.core.OutputFormat。
        - 避免内敛事件
            - 尽量不要使用 onLoad="onload('{{data}}')"、onClick="go('{{action}}')"这种拼接内联事件的写法。在 JavaScript 中通过 .addEventlistener()事件绑定会更安全。
        - 避免拼接 HTML
            - 前端采用拼接 HTML 的方法比较危险，如果框架允许，使用 createElement、setAttribute 之类的方法实现。或者采用比较成熟的渲染框架，如 Vue/React 等。
        - 使用CSP
            - Content Security Policy：禁止加载外域代码，防止复杂的攻击逻辑；禁止外域提交，网站被攻击后，用户的数据不会泄露到外域；禁止内联脚本执行；禁止未授权的脚本执行。
        - 使用httponly
            - HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。httponly无法完全的防御xss漏洞，它只是规定了不能使用js去获取cookie的内容，因此它只能防御利用xss进行cookie劫持的问题。Httponly是在set-cookie时标记的，可对单独某个参数标记也可对全部参数标记。由于设置httponly的方法比较简单，使用也很灵活，并且对防御cookie劫持非常有用，因此已经渐渐成为一种默认的标准。
    - 前端
        - 在不影响客户正常使用的情况下使用js，由客户端运行，过滤特殊字符，如:单引号'&' , '<' , '\' 之类的敏感字符转义为 &amp , &lt , &gt，用户所编写的HTML代码就变成了字符，剩下富文本格式。
    - 后端
        - PHP:
          - 直接输出到HTML的可以尝试使用以下方法进行过滤:htmlspecialchars函数、htmlentities函数、HTMLPurifier.auto.php插件等
          - 输出到JS代码中，或者开发Json API的，则需要前端在JS中进行过滤：
            - 1.尽量使用innerText(IE)和textContent(Firefox),也就是jQuery的text()来输出文本内容。
            - 2.必须要用innerHTML等等函数，则需要做类似php的htmlspecialchars的过滤。
        - Java:采用开源的实现 ESAPI library 参考网址:https://owasp.org/www-project-enterprise-security-api/
        - Asp:使用 Microsoft 防跨站点脚本库 (AntiXSS) 并将其设置为您的默认 HTML 编码器。



**SQL 注入**

`漏洞评级建议: 高危`

- 详情
    > 页面存在 SQL 注入漏洞,SQL 注入漏洞允许攻击者通过操纵用户输入来更改后端 SQL 语句。当 web 应用程序接受直接放入 SQL 语句的用户输入，并且没有正确过滤掉危险字符时，就会发生 SQL 注入。

- 造成的危害
    > 攻击者可以在易受攻击的系统上执行任意 SQL 语句。根据正在使用的后端数据库， SQL 注入漏洞会导致攻击者访问不同级别的数据/系统。不仅可以操作现有查询，还可以合并任意数据、使用子选择或追加附加查询。在某些情况下，可以读入或写出文件，或者在底层操作系统上执行 shell 命令。 某些 SQL 服务器包含存储和扩展过程(数据库服务器功能)。如果攻击者能够获得这些程序的访问权限，可能会危及整个机器。

- 修复建议
    ```
    1. 程序代码里的所有查询语句，使用标准化的数据库查询语句 API 接口，设定语句的参数进行过滤一些非法的字符，防止用户输入恶意的字符传入到数据库中执行 sql 语句。
    2. 对用户提交的的参数安全过滤，像一些特殊的字符(，()*&……%# 等等)进行字符转义操作,以及编码的安全转换。
    3. 网站的报错信息尽量不要返回给客户端，比如一些字符错误，数据库的报错信息，尽可能的防止泄露给客户端。
    ```

    - 代码层面
        - 输入验证
            1. 类型判断：字符型、整型；
            2. 长度判断：设置最大长度值；
            3. 业务参数合法性判断：比如支付金额不可能为负值这种；
            4. 特殊字符过滤：比如'，"，\，<，>，&，*，;，#，select，from，where，sub，if，union，sleep，and，or等；
            5. 验证所有的输入点，包括UA、Cookie以及其他HTTP头；
        - 预编译处理&参数化查询
            1. 所有与数据库交互的业务接口均采用参数化查询，参数化的语句使用参数而不是将用户输入变量嵌入到SQL语句中，参数化查询是防御SQL注入的最佳方法，比如：Java中的PreparedStatement，PHP中的PDO等。

    - 数据库层面
        - 最小权限原则
            - 遵循最小化权限原则，严格限制网站用户的数据库的操作权限，禁止将任何高权限帐户（sa，dba、root等）用于应用程序数据库访问，从而最大限度的减少注入攻击对数据库的危害。
        - 禁用敏感函数
            - 比如MSSQL中，拒绝用户访问敏感的系统存储过程，如xp_dirtree，xp_cmdshell等。
        - 权限控制
            - 限制用户所能够访问的数据库表。
    - 编码统一
        - 网站与数据层的编码统一，建议全部使用UTF-8编码，避免因上下层编码不一致导致一些过滤模型被绕过，比如宽字节注入等。

**XXE**

`漏洞评级建议: 高危`

- 详情
    > XML外部实体注入（XML External Entity Injection）漏洞是指当恶意用户在提交一个精心构造的包含外部实体引用的XML文档给未正确配置的XML解析器处理时，该攻击就会发生。

- 造成的危害
    1. 利用 XXE 进行 DOS 攻击；
    2. 读取本地任意敏感文件；
    3. 利用相关协议进行SSRF探测内网主机IP、端口等信息；
    4. 在特定条件下利用Java中的jar:// 协议，php 中的 phar://可能导致恶意文件上传；
    5. PHP中如果安装了expect扩展，可利用XXE执行任意命令

- 修复建议
    - 使用语言中推荐的禁用外部实体的方法
        - PHP：libxml_disable_entity_loader(true);
        - Java:
            - DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();
            - dbf.setExpandEntityReferences(false);
        - Python:
            - from lxml import etree
            - xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))
    - 手动黑名单过滤
        - 过滤XML中的相关关键词，比如：<!DOCTYPE、<!ENTITY SYSTEM、PUBLIC等。

**SSTI**

`漏洞评级建议: 高危`

- 详情
    > SSTI （服务器端模板注入）如果攻击者能够控制要呈现的模板，服务端接收了用户的恶意输入以后，未经任何处理就将其作为 Web 应用模板内容的一部分，模板引擎在进行目标编译渲染的过程中，执行了用户插入的可以破坏模板的语句，就可能导致上下文数据的暴露，甚至在服务器上运行任意命令的表达式。

- 造成的危害
    1. 获取上下文敏感数据信息、配置信息；
    2. 读取、写入恶意文档到服务器中；
    3. 执行系统命令；

- 修复建议
    1. 不要让用户对传入模板的内容或者模板本身进行控制。
    2. 减少或者放弃直接使用格式化字符串结合字符串拼接的模板渲染方式。
    3. 如果需要将动态数据传递给模板，不要直接在模板文件中执行，可以使用模板引擎的内置功能来扩展表达式，实现同样的效果。

**URL Redirect**

`漏洞评级建议: 中危`

- 详情
    > URL跳转、URL重定向漏洞，由于目标网站未对程序跳转的URL地址及参数做合法性判断，导致应用程序直接跳转到参数中指定的的URL地址。攻击者可通过将跳转地址修改为指向恶意站点，即可发起网络钓鱼、诈骗甚至窃取用户凭证等。

- 造成的危害
    1. 攻击者可能会使用 Web 服务器攻击其他站点；
    2. 如果对输出没有做严格限制，将可能导致反射性 XSS 漏洞；
    3. 黑产将利用此漏洞，从信任网站跳转到攻击者构造的恶意网站用来进行钓鱼、诈骗等行为；

- 修复建议
    1. 严格控制将要跳转的域名，如果某个业务事先已经确定将要跳转的网站，最稳妥的方式是将其直接编码在源代码中，通过 URL 中传入的参数来映射跳转网址。
    2. 严格验证跳转 URL 参数的有效性、合法性。
    3. 校验传入的 URL 参数是否为可信域名。

**CRLF Injection**

`漏洞评级建议: 中危`

- 详情
    > CRLF 是回车 + 换行（\r\n）的简称。在HTTP协议中，HTTP Header 与H TTP Body是用两个CRLF分隔的，浏览器就是根据这两个 CRLF 来取出 HTTP 内容并显示出来。所以，一旦我们能够控制 HTTP 消息头中的字符，注入一些恶意的换行，这样我们就能注入一些会话 Cookie 或者 HTML 代码，所以 CRLF Injection 又叫 HTTP Response Splitting，简称 HRS。

- 造成的危害
    1. 通过在响应头中设置一个 SESSION，即可造成一个“会话固定漏洞”；
    2. 通过向响应头中注入恶意配置，即可造成一个无视浏览器 Filter 的反射型 XSS；
    3. 跳转劫持；
    4. 通过注入 html 代码可以进行钓鱼；

- 修复建议
    1. 在设置 HTTP 响应头的代码中，过滤回车、换行(%0d，%0a，%0D，%0A)等字符，避免输入的数据污染到其他 HTTP 头。
    2. 对参数做合法性校验以及长度限制。

**HTTP参数污染漏洞**

`漏洞评级建议: 中危`

- 详情
    > HTTP参数污染漏洞（HTTP Parameter Pollution）简称HPP，由于HTTP协议允许同名参数的存在，同时，后台处理机制对同名参数的处理方式不当，造成“参数污染”。攻击者可以利用此漏洞对网站业务造成攻击，甚至结合其他漏洞，获取服务器数据或获取服务器最高权限。

- 造成的危害

    HTTP 参数污染的风险实际上取决于后端所执行的操作，以及被污染的参数提交到了哪里。
    - 对客户端的攻击，比如投票、跳转、关注等；
    - 绕过安全防护软件；

- 修复建议
    1. 对用户输入数据的参数的格式进行验证。
    2. 在 WAF 或其他网关设备（比如 IPS）在检查URL时，对同一个参数被多次赋值的情况进行特殊处理。
    3. 在代码层面，编写 WEB 程序时，要通过合理的 $_GET 方法获取 URL 中的参数值，而尝试获取 web 服务器返回给程序的其他值时要慎重处理。

### 信息泄露类

**测试系统环境开放**

`漏洞评级建议: 中危`

- 详情
    > 渗透测试过程中，发现目标测试系统访问对公网开放，无任何安全认证措施。

- 造成的危害
    > 即使是测试系统也可能会存在一定的敏感数据，而且攻击者也可能通过拿下测试系统的机器近一步的横向渗透，对整个业务系统造成极大影响。

- 修复建议
    1. 停止对外开放测试系统,并检查有无同类系统存在该问题。
    2. 应用系统在发布后应及时删除、关闭测试接口
    3. 应用系统在发布后应及时删除、关停测试账号
    4. 应用系统在发布后应及时删除测试文件
    5. 应用系统在发布后应及时清除数据表中的测试数据

**某查询接口造成用户信息泄露**

`漏洞评级建议: 高危`

- 详情
    > 在 xxxx 页面时，经过更改的查询请求可以绕过查询限制，从而查询到任意用户的缴费数据。

- 造成的危害
    > 恶意分子通过批量查询用户信息，导致用户 xxxx 信息泄漏，可以对用户实施钓鱼、诈骗等。甚至用于黑产。

- 修复建议
    > 对查询请求做好检查和限制。

**配置文件泄露 & 测试文件泄露**

`漏洞评级建议: 高危`

- 详情
    > 目标网站存在配置文件泄露问题，包含部分项目文件路径信息、配置参数信息等。

    或

    1. 目标网站存在测试文件泄露问题，测试文件中可能包含源代码，可导致源代码泄露.
    2. 目标网站存在测试文件泄露问题，测试文件中可能包含程序的部署信息，可导致部署信息泄露.
    3. 目标网站存在测试文件泄露问题，测试文件中可能数据库或其他内网系统的连接方式，可导致数据库密码、内网地址等其他敏感信息泄露.

- 造成的危害
    > 泄露的配置文件可能会包含路径信息，甚至可能包含部分数据库配置参数。

- 修复建议
    1. 修改配置文件使目标路径不可访问。
    2. 禁止在 Web 站点的发布下放置任何测试配置文件。
    3. 禁止在正式部署环境中存在调试文件和调试信息。
    4. 开发环境与部署环境分离，不要直接在线上系统修改代码。
    5. 建立规范的部署流程，不要直接在源代码的工作目录进行发布和署。

**phpinfo 信息泄露**

`漏洞评级建议: 信息`

- 详情
    > PHPInfo 信息泄露漏洞常发生一些默认的安装包，比如 phpstudy 等，默认安装完成后，没有及时删除这些提供环境测试的文件，比较常见的为 phpinfo.php、1.php 和 test.php， 主要用于网站建设过程中测试搭建的 PHP 环境是否正确，很多网站在测试完毕后并没有及时删除，因此当访问这些测试页面时，会输出服务器的关键信息，这些信息的泄露将导致服务器被渗透的风险。

- 造成的危害
    > phpinfo 返回的信息中包含了服务器的配置信息，包括:1.PHP编译选项以及文件扩展名的相关信息;2.php 的版本信息;3.php 的配置信息;4.数据库信息等敏感信息。这些敏感信息会帮助攻击者展开进一步的攻击。PHP中提供了 PHPInfo() 函数，该函数返回 PHP 的所有信息，包括了 PHP 的编译选项及扩充配置、PHP 版本、服务器信息及环境变量、PHP 环境变量、操作系统版本信息、路径及环境变量配置、HTTP 标头、及版权宣告等信息。

- 修复建议
    > 建议移除 phpinfo 文件。

**svn 源码泄露漏洞**

`漏洞评级建议: 中危,若无实际项目文件建议降为信息`

- 详情
    > Subversion，简称 SVN，是一个开放源代码的版本控制系统，相对于的 RCS、CVS，采用了分支管理系统，它的设计目标就是取代 CVS。互联网上越来越多的控制服务从 CVS 转移到 Subversion。在服务器上布署代码时。如果是使用 svn checkout 功能来更新代码，而没有配置好目录访问权限，则会存在此漏洞。

- 造成的危害
    > 黑客可以借助其中包含的用于版本信息追踪的‘entries’文件，逐步摸清站点结构。"(可以利用.svn/entries文件，获取到服务器源码、svn服务器账号密码等信息)更严重的问题在于，SVN产生的.svn目录下还包含了以.svn-base结尾的源代码文件副本(低版本SVN具体路径为text-base目录，高版本SVN为pristine目录)，如果服务器没有对此类后缀做解析，黑客则可以直接获得文件源代码。

- 修复建议
    1. 查找服务器上所有 .svn 隐藏文件夹，删除。
    2. 开发人员在使用 SVN 时，严格使用导出功能。禁止直接复制代码。

**CVS 存储库文件泄露**

`漏洞评级建议: 中危,若无实际项目文件建议降为信息`

- 详情
    > cvs 项目在初始化(cvs checkout project)的时候, 会在 project 目录下创建一个名为 CVS 的目录,其中保存了各个文件的修改和 commit 记录. 通过此目录可以获取代码的历史版本. 其中两个关键文件为:CVS/Root 和 CVS/Entries, 分别记录了项目的根信息和所有文件的结构。

- 造成的危害
    > 通过此目录可以获取代码的历史版本.泄露源代码。

- 修复建议
    > 删除相应文件夹,使用其他版本控制工具.

**.git 源码泄漏**

`漏洞评级建议: 中危,若无实际项目文件建议降为信息`

- 详情
    > 开发者在使用git作为版本控制时，在一个目录中初始化一个仓库以后 , 会在这个目录下产生一个名叫 .git 的隐藏文件夹，这个文件夹里面保存了这个仓库的所有版本等一系列信息。如果服务器将.git文件夹放在了web目录下，就可能导致攻击者利用.git文件夹内的信息获取应用程序所有源代码。

- 造成的危害
    1. 攻击者利用此漏洞可获取应用程序源代码，分析源码进行进一步攻击利用；
    2. 攻击者利用此漏洞可获取数据配置信息，可能直接导致应用程序用户信息泄漏，设置获取服务器权限；

- 修复建议
    1. 查找服务器上所有 .git 隐藏文件夹，删除。
    2. 中间件上设置 .git 目录访问权限，禁止访问

**DS_Store info**

`漏洞评级建议: 中危,若无实际项目文件建议降为信息`

- 详情
    > 苹果的操作系统会在每一个文件夹中产生这个文件记录这个文件夹中的相关信息。实际上，这一文件包含了文件夹中所有的文件名和子文件夹名。和windows相比，等同于desktop.ini和Thumbs.db两个文件。

- 造成的危害
    1. 攻击者利用该漏洞可能获取网站相关的文件夹和文件名；
    2. 攻击者可通过解析这一文件，可能会发现数据库备份文件、配置文件以及一些缓存文件，甚至是密钥等；

- 修复建议
    1. 在不影响代码运行的情况下，删除 .DS_Store 文件。
    2. 在中间件中设置对应的文件、目录的访问权限

### 逻辑类漏洞

**未授权访问**

`漏洞评级建议: 视情况而定,水平越权默认中危,垂直越权默认高危`

- 详情
    > 接口未授权访问，顾名思义在不进行请求授权的情况下，能够直接对相应的业务逻辑功能进行访问、操作等。通常是由于认证页面存在缺陷或者无认证、安全配置不当等导致的。

- 造成的危害
    1. 攻击者可在没有认证的情况下直接操作对应的API接口，可直接被非法增删改次数据。
    2. 因为攻击是在未认证下进行的，所以后续无法通过定位用户进行异常排查。

- 修复建议
    1. 日常开发中要多留意业务逻辑可能出现的漏洞和水平权限漏洞或者其它未发现的漏洞。
    2. 鉴权，服务端对请求的数据和当前用户身份做校验;完善基础安全架构，完善用户权限体系。
    3. 对于后台接口，确保所有API接口先经过登录控制器。
    4. 在验证用户身份权限前不进行任何数据的交互。

**越权漏洞**

`漏洞评级建议: 视情况而定,水平越权默认中危,垂直越权默认高危`

- 详情

    越权漏洞是指应用程序未对当前用户操作的身份权限进行严格校验，导致用户可以操作超出自己管理权限范围的功能，从而操作一些非该用户可以操作的行为。

    - 水平越权
        - 攻击者可以访问与他拥有相同权限的用户的资源，资源权限ID不变，资源归属ID改变；
    - 垂直越权
        - 低级别攻击者可以访问高级别权限用户的资源，资源权限ID不变，资源归属ID改变；
        - 低级别攻击者可以访问高级别权限用户的资源，资源权限ID改变，资源归属ID不变；

- 造成的危害
    - 水平越权
        - 水平越权会导致同一层级间的用户可以互相访问到对方的敏感信息，如姓名、手机号、联系地址、个人资料、订单记录等。同时还可能会以其他平级权限用户的身份来执行某行功能，如删除，添加，修改等。
    - 垂直越权
        - 垂直越权漏洞会导致低权限用户用来执行高权限用户的功能，获取高权限用户的账号信息，执行高权限用户的操作功能。

- 修复建议
    1. 日常开发中要多留意业务逻辑可能出现的漏洞和水平权限漏洞或者其它未发现的漏洞。
    2. 鉴权，服务端对请求的数据和当前用户身份做校验;完善基础安全架构，完善用户权限体系。
    3. 对于后台接口，确保所有API接口先经过登录控制器。
    4. 在验证用户身份权限前不进行任何数据的交互。
    5. 严格校验当前用户操作与当前登录用户身份权限是否匹配。

**支付数据可被篡改**

`漏洞评级建议: 高危`

- 详情
    > 填写完缴款页面，在进入网银缴费页面前，确认缴费信息时，可通过 burpsuite 软件篡改本地缴费金额，欺骗本地缴费系统，以达到以少付多的效果。

- 造成的危害
    > 例如某机关单位张三缴款时利用该漏洞缴款 100000 元，本地篡改数据为 0.1 元，即可完成只花费 0.1 元实现 100000 元的缴款。

- 修复建议
    1. 对支付数据表进行数据包加密；
    2. 对提交数据包做数据签名处理，保证支付数据参数无法修改；
    3. 服务端效验客户端提交的参数；
    4. 服务端严格校验支付参数的合法性，比如金额、数量的长度，金额、数量的正负等；
    5. 对于用户提交的数据，应从数据库重新拉取，并校验用户提交与用户所有是否匹配；
    6. 对于多线程等并发问题，可以先打入队列，在与数据库交互；


**短信验证码接口可被利用**

`漏洞评级建议: 中危`

- 详情
    > 在用户注册页面， 其发所短信验证码接口未做限制，导致重复发包时可以绕过前台时间限制。

- 造成的危害
    > 攻击者可以重复 post 请求，针对某手机号进行短信轰炸。

- 修复建议
    1. 将短信验证码时间限制判断放在后端进行。
    2. 同一手机号，60秒内不能重复发送，24小时内总共发送不超过5次。
    3. 加上 IP 限制，例如某 IP 一小时内连续登录发送 3 次，6 个小时内禁止该 ip 发送。

**批量用户注册**

`漏洞评级建议: 中危`

- 详情
    > 目标网站注册页面无认证码，通过抓包修改账号参数，即可批量注册，即使手机号、身份证相同也可成功。

- 造成的危害
    > 攻击者可通过脚本批量注册用户，造成系统资源的浪费和占用.

- 修复建议
    1. 在注册页面加上验证码
    2. 后台再次确认数据唯一性

**存在爆破风险**

`漏洞评级建议: 低危,若无实际利用点建议降为信息`

- 详情
    > 在后台登录页面，登录时错误提示信息明确，因此可以判断用户名是否存在，然后针对用户名进行暴力破解。

    或

    > 在后台登录页面，登录时错误提示信息明确，且未对登录失败做访问控制，导致攻击者可以进行持续暴力破解登录口令。

- 造成的危害
    > 攻击者可以针对某已知用户名进行慢速暴力破解，从而进入后台。

- 修复建议
    1. 修改错误提示信息，加强逻辑认证。
    2. 针对登陆次数进行限制，可使用登陆远程 IP 或用户名两种方式进行锁定，登录错误次数 5 分钟之内超过 3 次锁定 1-3 小时。
    3. 对于管理类系统配置登陆用户允许的 IP 范围

**验证码可绕过**

`漏洞评级建议: 低危,若无实际利用点建议降为信息`

- 详情
    > 在后台登录页面，验证码只在前台 js 校验，攻击者在爆破账号可以进行绕过。

    或

    > 在后台登录页面，验证码只验证一次，攻击者只需截取第一个包即可进行绕过实施账号爆破。

- 造成的危害
    > 由于可以绕过验证码，导致攻击者对后台的爆破难度大大降低。

- 修复建议
    1. 验证码后端随机生成，且验证码内容不能出现在客户端的网页源代码以及response数据包中。
    2. 验证码要有背景干扰，干扰元素包括：颜色、位置、数量且元素需要随机变化。
    3. 验证码后端校验，且使用一次后即失效。
    4. 验证码在不同场景下需要与请求的参数一起提交给后端进行校验，且优先校验验证码。


**手机验证码可爆破**

`漏洞评级建议: 中危,若无实际利用点建议降为低危 如2分钟或3分钟内6位数`

- 详情：
    > 在XXX中在发送验证码后构造短信验证码列表，对手机验证码进行爆破测试。发现爆破成功，目标存在手机验证码可被爆破漏洞。


- 造成的危害：
    > 目标网站未对验证码输入失败做访问控制，导致攻击者可以进行持续暴力破解用户手机验证码。

- 修复建议：
    > 针对输入次数进行限制，可使用限制登陆远程 IP 或用户名两种方式进行锁定，登录错误次数 5 分钟之内超过 3 次锁定 1-3 小时。

### 中间件/服务

**Ghostcat(CVE-2020-1938)漏洞**

`漏洞评级建议: 高危`

- 详情
    > 渗透测试过程中，发现目标存在Ghostcat漏洞。该漏洞允许黑客远程访问Apache Tomcat服务器，获取系统源代码。

- 造成的危害

    > 该漏洞位于Apache Tomcat软件的AJP协议中，该漏洞允许未经身份验证的攻击者远程访问服务器上部署的应用程序和源代码文件。

- 修复建议
    > 针对 CVE-2020-1938 漏洞， Apache Tomca官方已放出相应的修复新版本，建议及时安装官方新版本。


**iis 短文件名泄露漏洞**

`漏洞评级建议: 低危`

- 详情
    > 目标存在 IIS 短文件名泄露漏洞。攻击者可利用此漏洞枚举网络服务器根目录中的文件。

- 造成的危害
    > 攻击者可以利用该漏洞猜解后台地址和敏感文件甚至直接下载对应文件，或对 IIS 服务器中的 .Net Framework 进行拒绝服务攻击。

- 修复建议
    1. 升级 .net framework 至 4.0 版本或以上
    2. 修改注册表中  HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem 值 NtfsDisable8dot3NameCreation 为 1

**Elasticsearch 未授权访问漏洞**

`漏洞评级建议: 高危`

- 漏洞描述：
    > 由于 Elasticsearch 授权模块需要付费，所以免费开源的 Elasticsearch 可能存在未授权访问漏洞。该漏洞导致，攻击者可以拥有 Elasticsearch 的所有权限。可以对数据进行任意操作。

- 危害：
    > 攻击者通常可以请求一个开放9200或9300的端口对服务器进行恶意攻击。业务系统将面临敏感数据泄露、数据丢失、数据遭到破坏甚至遭到攻击者的勒索。

- 修复建议：
    1. 限制 IP 访问，绑定固定 IP。
    2. 在 config/elasticsearch.yml 中为9200端口设置认证。

**XXX 中间件存在 XXX 远程代码执行漏洞**

`漏洞评级建议: 高危`

- 详情
    > 渗透测试过程中，发现目标站点存在 XXX 远程代码执行漏洞，该漏洞可以远程执行任意代码。

- 造成的危害
    > 由于该漏洞影响范围较广，漏洞危害程度严重，可造成直接获取应用系统所在服务器的控制权限。

- 修复建议
    > 及时更新网站 XXX 应用或更新相应补丁。具体修复方案参考官方的安全公告。

**JQuery 版本过低存在XSS漏洞风险**

`漏洞评级建议: 低危`

- 详情
    > 渗透测试过程中，发现目标站点存在 JQuery 框架库漏洞，所引用的 jQuery 版本可能会存在XSS漏洞。

- 造成的危害
    > 目标网站使用了存在漏洞的 JQuery 库，jQuery 中过滤用户输入数据所使用的正则表达式存在缺陷，可能导致 location.hash 跨站脚本攻击。攻击者可以利用此漏洞进行 XSS、cookioe 劫持等攻击。

- 修复建议
    1. 更新 jQuery 到 3.5.0 或更高版本。
    2. 使用全局的 XSS 过滤清理用户输入的 HTML。

---

## 数据库

**Oracle 远程数据投毒漏洞(CVE-2012-1675)**

`漏洞评级建议: 低危`

- 详情
    > 服务器存在 oracle 远程数据投毒漏洞，该漏洞可以远程获取到 oracle 的内存信息，若是能获取到内存中的数据即为存在漏洞，进而可以再爆破 oracle 的 SID。

- 造成的危害
    > 攻击者可以在不需要用户名密码的情况下利用网络中传送的数据消息(包括加密或者非加密的数据)，如果结合(CVE-2012-3137 漏洞进行密码破解)从而进一步影响甚至控制局域网内的任何一台数据库。

- 修复建议
    1. 不应该使用安装 Oracle 时默认的 SID(ORCL)，应该设置复杂度较高的 SID。
    2. 对于短时间内难以通过第1种方式修补漏洞的情况，应考虑加强主机和网络层面的访问控制策略。例如采用白名单的方式，仅允许授权主机 IP 访问该端口，避免漏洞被攻击者恶意利用。

**Redis 未授权访问漏洞**

`漏洞评级建议: 高危`

- 详情
    > Redis 默认情况下，会绑定在 0.0.0.0:6379，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，这样将会将 Redis 服务暴露到公网上，如果在没有设置密码认证（一般为空）的情况下，会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis 的数据。

- 造成的危害
    > 攻击者在未授权访问 Redis 的情况下，利用 Redis 自身的提供的config 命令，可以进行写文件操作，攻击者可以成功将自己的ssh公钥写入目标服务器的 /root/.ssh 文件夹的authotrized_keys 文件中，进而可以使用对应私钥直接使用ssh服务登录目标服务器、添加计划任务、写入Webshell等操作。

- 修复建议
    1. 禁止使用root权限启动redis服务。
    2. 对redis访问启动密码认证。
    3. 添加IP访问限制，并更改默认6379端口。

**Mongodb 未授权访问漏洞**

`漏洞评级建议: 高危`

- 详情
    > 目标 Mongodb 服务存在未授权访问漏洞，开启 MongoDB 服务时不添加任何参数时,默认是没有权限验证的,登录的用户可以通过默认端口无需密码对数据库任意操作（增、删、改、查高危动作）而且可以远程访问数据库。

- 造成的危害
    > 使用默认空口令这将导致恶意攻击者无需进行账号认证就可以登陆到数据服务器。

- 修复建议
    1. 为MongoDB添加认证：MongoDB启动时添加--auth参数、为MongoDB添加用户
    2. MongoDB 自身带有一个HTTP服务和并支持REST接口。在2.6以后这些接口默认是关闭的。mongoDB默认会使用默认端口监听web服务，一般不需要通过web方式进行远程管理，建议禁用。修改配置文件或在启动的时候选择 –nohttpinterface 参数 nohttpinterface=false
    3. 启动时加入参数--bind_ip 127.0.0.1 或在/etc/mongodb.conf文件中添加以下内容：bind_ip = 127.0.0.1

**Memcahce 未授权访问**

`漏洞评级建议: 高危`

- 详情
    > 目标 Memcahce 服务存在未授权访问漏洞,Memcached 端口对外开放并且没有配置认证选项，未授权用户可直接获取数据库中所有信息，造成严重的信息泄露。

- 造成的危害
    > 除 memcached 中数据可被直接读取泄漏和恶意修改外，由于 memcached 中的数据像正常网站用户访问提交变量一样会被后端代码处理，当处理代码存在缺陷时会再次导致不同类型的安全问题。不同的是，在处理前端用户直接输入的数据时一般会接受更多的安全校验，而从 memcached 中读取的数据则更容易被开发者认为是可信的，或者是已经通过安全校验的，因此更容易导致安全问题。

- 修复建议
    ```
    1. 配置 memcached 监听本地回环地址 127.0.0.1。
    vim /etc/sysconfig/memcached
    OPTIONS="-l 127.0.0.1"  # 设置本地为监听
    /etc/init.d/memcached restart   # 重启服务

    2. 当 memcached 配置为监听内网 IP 或公网 IP 时， 使用主机防火墙(iptalbes、 firewalld 等)和 网络防火墙对 memcached 服务端口 进行过滤。
    ```

## 远程服务

**CVE-2018-15473 OpenSSH 用户枚举漏洞**

`漏洞评级建议: 低危`

- 详情
    > 通过向 OpenSSH 服务器发送一个错误格式的公钥认证请求，可以判断是否存在特定的用户名。如果用户名不存在，那么服务器会发给客户端一个验证失败的消息。如果用户名存在，那么将因为解析失败，不返回任何信息，直接中断通讯。

- 造成的危害
    > 由于 SSH 本身的认证机制存在缺陷，导致攻击者可以使用字典，暴力枚举 SSH 存在的用户名(Username)。

- 修复建议
    > 升级 openssh。

## 文件服务

**CVE-1999-0554 目标主机 showmount -e 信息泄露**

`漏洞评级建议: 高危`

- 详情
    > 目标服务器由于错误的 nfs 配置，可以对目标主机进行"showmount -e"操作。

- 造成的危害
    > NFS 服务配置漏洞将泄露目标主机大量敏感信息，比如目录结构。更糟糕的是，如果访问控制不严的话，攻击者有可能直接访问到目标主机上的数据。

- 修复建议
    1. 修改 NFS 配置文件，限制可以获取 NFS 输出列表的 IP 和用户。
    2. 除非绝对必要，请关闭 NFS 服务、MOUNTD。

## 分布式

**Hadoop 未授权访问漏洞**

`漏洞评级建议: 高危`

- 详情
    > 该问题产生是由于管理员在配置失误所致，导致直接开放了 Hadoop 机器 HDFS 的 50070 web 端口及部分默认服务端口。

- 造成的危害
    > 黑客可以通过命令行操作多个目录下的数据，如进行删除，下载，目录浏览甚至命令执行等操作，产生极大的危害。

- 修复建议
    1. 如无必要，关闭 Hadoop Web 管理页面。
    2. 开启身份验证，防止未经授权用户访问。
    3. 设置“安全组”访问控制策略，将 Hadoop 默认开放的多个端口对公网全部禁止或限制可信任的 IP 地址才能访问包括 50070 以及 WebUI 等相关端口。

**ZooKeeper 未授权访问漏洞**

`漏洞评级建议: 高危`

- 详情
    > ZooKeeper 是一个分布式的，开放源码的分布式应用程序协调服务，是 Google 的 Chubby 一个开源的实现，是 Hadoop 和 Hbase 的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。ZooKeeper 的目标就是封装好复杂易出错的关键服务，将简单易用的接口和性能高效、功能稳定的系统提供给用户。在通常情况下，zookeeper 允许未经授权的访问。

- 造成的危害
    > 攻击者渗透中遇到 ZooKeeper 集群后，可以查找事务日志来获取 admin 的密码或者其他敏感资源的认证方法。用户或者客户端根本不需要任何的认证就可以连上 ZooKeeper 的服务端，并且可以对 znode 进行增删等操作。这样数据是非常不安全的，极易被攻击和篡改。

- 修复建议
    1. 修改 ZooKeeper 默认端口，采用其他端口服务。
    2. 添加访问控制，配置服务来源地址限制策略。
    3. 增加 ZooKeeper 的认证配置。

## 虚拟化

**Docker Remote API 未授权访问漏洞**

`漏洞评级建议: 高危`

- 详情：
    > 目标 Docker Remote API 配置不当可导致未授权访问，可被攻击者恶意利用。

- 危害：
   > 攻击者无需认证即可访问到 Docker 数据，可能导致敏感信息泄露，黑客也可以删除 Docker 上的数据。攻击者可进一步利用 Docker 自身特性，直接访问宿主机上的敏感信息，或对敏感文件进行修改，最终完全控制服务器。

- 修复方法：
    1. 修改 Docker Remote API 服务默认参数。
    2. 修改 Docker 的启动参数：定位到 DOCKER_OPTS 中的 tcp://0.0.0.0:2375，将0.0.0.0修改为127.0.0.1 或将默认端口 2375 改为自定义端口为 Remote API 设置认证措施。
    3. 设置防火墙策略。如果正常业务中 API 服务需要被其他服务器来访问，可以配置安全组策略或 iptables 策略，仅允许指定的 IP 来访问 Docker 接口。
    4. 修改 Docker 服务运行账号。请以较低权限账号运行 Docker 服务；另外，可以限制攻击者执行高危命令。

---

# 协议

**SNMP 默认团体字符串可被枚举**

`漏洞评级建议: 低危`

- 详情
    > 渗透测试过程中，发现目标 SNMP 服务配置了默认的团体字符串，snmp 是用来进行网络管理的。cacti 和 mrtg 等监控工具都是基于 snmp 协议。

- 造成的危害
    > snmp 弱口令或者口令泄漏引起的安全问题:一是信息泄漏，二是设备的配置可能被修改从而被他人控制。

- 修复建议
    1. 修改 SNMP 的默认团体字符串，使用强度更高的字符串。
    2. 开启 snmp 服务的设备采用 snmp v3 用户，因为 snmp v3 支持用户认证与加密，安全性更好、更可靠。

**ssl 版本过低**

`漏洞评级建议: 信息`

- 详情：
    > SSL协议是HTTP的补充，使用加密等方法让HTTP更安全；TLS是基于SSL v3的升级版协议，目前版本发展为v1.0 v1.1 v1.2。当前TLS版本过低，存在许多严重漏洞，这些漏洞使得目标存在被攻击的风险。

- 造成的危害：
    > 使用老旧的弱加密算法，信息将存在被中间人攻击和窃取的风险。

- 修复建议：
    > 使用严格的https证书，升级ssl到最新的版本。

---

# 安卓

**Web 组件远程代码执行漏洞**
- 描述:
    > 该危险 api 可通过 webview 对象向页面 javascript 导出 java 本地接口，可能导致任意命令执行。

- 修复建议：
    > 建议禁用危险接口 API 导出 Java 类和方法，并加强访问的 url 的域控制；

**https 敏感数据劫持漏洞**
- 描述:
    > 危险api不正确使用https相关函数，可能引发通信加密失效，导致敏感数据泄漏.

- 修复建议：
    > 建议对自定义的 X509TrustManager 实现对证书的严格校验；API 接口请设置安全选项级别

**应用数据任意备份风险**
- 描述:
    > Android 2.1以上的系统可为App提供应用程序数据的备份和恢复功能，该由 AndroidMainfest.xml 文件中的 allowBackup 属性值控制，其默认值为 true。当该属性没有显式设置为false时,攻击者可通过adb backup和adb restore对App的应用数据进行备份和恢复,从而可能获取明文存储的用户敏感信息，如用户的密码、证件号、手机号、交易密码、身份令牌、服务器通信记录等。利用此类信息攻击者可伪造用户身份，盗取用户账户资产，或者直接对服务器发起攻击。

- 修复建议：
    > 关闭 AndroidManifest.xml 中的组件导出权限，对于必须导出的组件必须限制于授权用户或者应用组件。建议再 AndroidManifest.xml 中把 android:debuggable 和 android:allowBackup 属性显式设置为 false

**敏感函数调用风险**
- 描述:
    > 敏感行为包括发送、拦截短信，读取、修改通讯录、通话记录，拨打电话，发送地理位置，使用摄像头，访问浏览器历史记录等。函数调用这些敏感行为，可能导致用户隐私数据泄露，钓鱼扣费等风险。

- 修复建议：
    > 审核包含敏感行为的函数调用，确保其使用是必要且限制于授权用户的。

**调试日志函数调用风险**
- 描述:
    > 调试日志函数可能输出重要的日志文件，其中包含的信息可能导致客户端用户信息泄露，暴露客户端代码逻辑等，为发起攻击提供便利，例如：Activity 的组件名，是 Activity 劫持需要的信息；通信交互的日志，会成为发动服务器攻击的依据；跟踪的变量值，可能泄露一些敏感数据，输入的账号、密码等。

- 修复建议：
    > 关闭调试日志函数调用，或者确保日志的输出使用了正确的级别，涉及敏感数据的日志信息在发布版本中被关闭。

**内网测试信息残留漏洞**
- 描述:
    > 通过检测是否包含内网 URl 地址,判断是否发布包中是否包含测试数据。残留的测试数据，例如 URL 地址，测试账号，密码，可能会被盗取并恶意利用在正式服务器上进行攻击，例如账号重试，攻击安全薄弱的测试服务器以获取服务器安全漏洞或者逻辑漏洞。

- 修复建议：
    > 建议开发者根据测评结果检测相关文件中是否包含更多的测试数据。

---

# 测试

**弱口令组合爆破测试**
- 详情
    > 渗透测试过程中对目标登录页面进行弱口令组合爆破测试，测试使用TOP1000弱口令组合字典。

- 测试结果
    > XXXXX

**敏感文件目录爆破测试**
- 详情
    > 渗透测试过程中对目标URL进行目录扫描、敏感文件扫描，使用TOP1000常见路径字典和TOP1000备份文件字典。

- 测试结果
    > XXXXX

**文件上传测试**
- 详情
    > 渗透测试过程中对目标编辑器上传页面进行文件上传漏洞测试。

- 测试结果
    > XXXXX

**RDP 爆破测试**
- 详情
    > 渗透测试过程中对目标主机进行RDP爆破测试，使用TOP1000弱口令组合。

- 测试结果
    > XXXXX

**Struts2 漏洞测试**
- 详情
    > 渗透测试过程中对目标网站测试Apache Struts2框架漏洞。

- 测试结果
    > XXXXX.

**XSS 漏洞测试**
- 详情
    > 渗透测试过程中对目标网站进行XSS跨站脚本攻击漏洞测试。

- 测试结果
    > XXXXX.
**SQL注入测试**
- 详情
    > 渗透测试过程中发现目标存在搜索功能，进行SQL注入测试。

- 测试结果
    > 经检测，未注入成功，目标不存在SQL 注入测试。

**Oracle 远程数据投毒漏洞测试**
- 详情
    > 对目标 Oracle 数据库进行远程数据投毒漏洞测试。该漏洞可以远程获取到 Oracle 的内存信息，若是能获取到内存中的数据即为存在漏洞，进而可以再爆破 Oracle 的 SID。

- 测试结果
    >经检查，目标不存在Oracle 远程数据投毒漏洞。

**TLS安全可靠性测试**
- 详情
    > 对目标TLS安全可靠性进行了扫描，测试了常见TLS存在的漏洞及加密认证方式支持程度。

- 测试结果
    >经检查，发现不存在可实际利用的中高危漏洞。
